<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Recommendation Engine</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- All CSS is embedded in this file -->
    <style>
        :root {
            --primary-color: #4a90e2;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary-color: #a0a0a0;
            --border-color: #333;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 2.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; }
        header h1 { font-size: 2.5rem; font-weight: 600; }
        header p { color: var(--text-secondary-color); font-size: 1.1rem; }
        
        .section-title {
            text-align: center;
            font-size: 1.3rem;
            color: var(--text-secondary-color);
            margin-bottom: 1.5rem;
            font-weight: 300;
        }
        
        .mood-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 3rem;
        }
        .mood-button {
            padding: 0.7rem 1.5rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background-color: transparent;
            color: var(--text-secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mood-button:hover {
            background-color: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
        }

        .search-container { display: flex; justify-content: center; margin-bottom: 3rem; gap: 1rem; }
        #username-input { width: 100%; max-width: 400px; padding: 0.8rem 1rem; font-size: 1rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--surface-color); color: var(--text-color); }
        #search-button { padding: 0.8rem 1.5rem; font-size: 1rem; font-weight: 600; border: none; border-radius: 8px; background-color: var(--primary-color); color: #fff; cursor: pointer; transition: background-color 0.3s ease; }
        #search-button:hover { background-color: #357abd; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        
        .video-card {
            background-color: var(--surface-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 280px; 
            display: flex;
            flex-direction: column;
            cursor: pointer; /* Add pointer to show it's clickable */
        }
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.2);
        }
        .video-thumbnail {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background-color: #333;
            display: block;
        }
        .video-info {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            overflow: hidden;
        }
        .video-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .video-category {
            font-size: 0.85rem;
            color: var(--text-secondary-color);
            background-color: rgba(255, 255, 255, 0.08);
            padding: 0.25rem 0.6rem;
            border-radius: 15px;
            display: inline-block;
            align-self: flex-start;
            margin-top: auto;
        }

        #message-container { text-align: center; margin-top: 2rem; font-size: 1.1rem; color: var(--text-secondary-color); }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.2); border-left-color: var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 2rem auto; }
        @keyframes spin { to { transform: rotate(360deg); } }
        footer { text-align: center; margin-top: 4rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); color: var(--text-secondary-color); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Video Recommendation Engine</h1>
            <p>Your personalized gateway to inspiring content</p>
        </header>

        <main>
            <h2 class="section-title">For new users: How are you feeling today?</h2>
            <div class="mood-container" id="mood-container">
                <button class="mood-button" data-mood="Inspired">‚ú® Inspired</button>
                <button class="mood-button" data-mood="Motivated">üöÄ Motivated</button>
                <button class="mood-button" data-mood="Calm">üßò Calm</button>
                <button class="mood-button" data-mood="Curious">ü§î Curious</button>
            </div>
            
            <h2 class="section-title">For existing users: Search by username</h2>
            <div class="search-container">
                <input type="text" id="username-input" placeholder="Enter a username from the database...">
                <button id="search-button">Get Feed</button>
            </div>

            <div id="video-feed" class="video-grid"></div>
            <div id="message-container"></div>
        </main>

        <footer>
            <p>Built with ‚ù§Ô∏è ~ LOVELY RAJPUT</p>
        </footer>
    </div>

    <!-- All JavaScript is embedded in this file -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchButton = document.getElementById('search-button');
            const usernameInput = document.getElementById('username-input');
            const moodContainer = document.getElementById('mood-container');
            const videoFeed = document.getElementById('video-feed');
            const messageContainer = document.getElementById('message-container');

            const fetchAndDisplayFeed = async (url, notFoundMessage) => {
                videoFeed.innerHTML = '';
                messageContainer.innerHTML = '<div class="spinner"></div>';
                try {
                    const response = await fetch(url);
                    if (!response.ok) { throw new Error(`API Error: ${response.statusText}`); }
                    const recommendedVideos = await response.json();
                    messageContainer.innerHTML = '';

                    if (Array.isArray(recommendedVideos) && recommendedVideos.length > 0) {
                        recommendedVideos.forEach(video => {
                            // --- THIS IS THE FINAL CHANGE ---
                            // 1. Create an anchor tag (a link)
                            const link = document.createElement('a');
                            link.href = video.video_link || '#'; // Use the real video_link from the backend
                            link.target = '_blank'; // Open the link in a new tab
                            link.style.textDecoration = 'none'; // Remove the default underline

                            // 2. Create the card div
                            const card = document.createElement('div');
                            card.className = 'video-card';
                            
                            const placeholderSvg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 225'%3E%3Crect width='400' height='225' fill='%23333'/%3E%3C/svg%3E`;
                            const thumbnailUrl = video.thumbnail_url || placeholderSvg;

                            card.innerHTML = `
                                <img src="${thumbnailUrl}" alt="Video thumbnail" class="video-thumbnail" onerror="this.onerror=null;this.src='${placeholderSvg}';">
                                <div class="video-info">
                                    <h3 class="video-title" title="${video.content || 'Untitled Video'}">${video.content || 'Untitled Video'}</h3>
                                    <span class="video-category">${video.project_code || 'General'}</span>
                                </div>
                            `;
                            
                            // 3. Put the card INSIDE the link, then put the link on the page
                            link.appendChild(card);
                            videoFeed.appendChild(link);
                            // ------------------------------------
                        });
                    } else {
                        messageContainer.textContent = notFoundMessage;
                    }
                } catch (error) {
                    console.error('Error fetching feed:', error);
                    messageContainer.textContent = 'Failed to fetch recommendations. Check the console for errors.';
                }
            };

            searchButton.addEventListener('click', () => {
                const username = usernameInput.value.trim();
                if (username) {
                    const url = `/feed?username=${username}`;
                    const message = `Data not found for user '${username}'. Please try another user.`;
                    fetchAndDisplayFeed(url, message);
                } else {
                    messageContainer.textContent = 'Please enter a username.';
                }
            });

            usernameInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    searchButton.click();
                }
            });
            
            moodContainer.addEventListener('click', (event) => {
                if (event.target.classList.contains('mood-button')) {
                    const mood = event.target.dataset.mood;
                    const url = `/feed/mood?mood=${mood}`;
                    const message = `No videos found for the mood '${mood}'.`;
                    fetchAndDisplayFeed(url, message);
                }
            });
        });
    </script>
</body>
</html>